---
title: GKEにデプロイされているRabbitMQのメッセージ数などを確認する
date: '2026-01-14'
tags:
  - RabbitMQ
  - GKE
cover: https://www.ibm.com/content/adobe-cms/jp/ja/products/instana/supported-technologies/rabbitmq-monitoring/jcr:content/root/table_of_contents/body/content_section_styled/content-section-body/complex_narrative/logoimage.coreimg.png/1692219515370/rabbit.png
published: true
---

## はじめに

この記事では、GKEにデプロイされているRabbitMQのメッセージに対する、consumerの数やunackの数を調べる方法を説明します。

## 手順

まず、RabbitMQのポッドを特定します。
```bash
kubectl get pods -A | egrep -i 'rabbit|rmq'
```

環境変数に名前空間とポッド名を設定しておきます。
```bash
NS_RMQ=<namespace>
POD_RMQ=<pod_name>
```

RabbitMQのあるポッドに入ります。
```bash
kubectl -n "$NS_RMQ" exec -it "$POD_RMQ" -- bash
```

---

rabbitmqctlのコマンドでメトリクスのスナップショットを見ることができます。ここでは
- キュー名
- バックログのメッセージ数
- 未ackのメッセージ数
- consumerの数
を取得できます。

```bash
rabbitmqctl list_queues name messages_ready messages_unacknowledged consumers \
| grep -E '<queue_name>|name'
```

```bash
name           messages_ready messages_unacknowledged consumers 
<queue_name>   51684         30000                     300
```
とこんな感じです。

## 余談
KEDAのautoscalingをRabbitMQのキューにあるメッセージの数で設定していたのですが、全然思い通りにならなかった時に調べたメモです。

## 更新記録
- 2026-01-15 RabbitMQのキューにあるメッセージの数を取得に関する参考文献を追加（これ自分のローカルで検証してみたい）

## 参考文献

- [rabbimqctlのlist_queues](https://www.rabbitmq.com/docs/man/rabbitmqctl.8#list_queues)
- [RabbitMQ Queue](https://keda.sh/docs/2.18/scalers/rabbitmq-queue/)